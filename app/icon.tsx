import { ImageResponse } from 'next/og'
import { NextRequest } from 'next/server'

export const runtime = 'edge'
export const contentType = 'image/png'

// Default size for favicon
export const size = {
  width: 32,
  height: 32,
}

// Image generation with dynamic sizing from query params
export default function Icon(request: NextRequest) {
  // Extract size from URL search params
  const searchParams = request.nextUrl?.searchParams
  const requestedSize = searchParams?.get('size')
  const iconSize = requestedSize ? parseInt(requestedSize) : 32

  // Clamp size between 16 and 512 for safety
  const finalSize = Math.min(Math.max(iconSize, 16), 512)

  return new ImageResponse(
    (
      <div
        style={{
          width: '100%',
          height: '100%',
          display: 'flex',
          alignItems: 'center',
          justifyContent: 'center',
          background: '#1a1a2e',
          borderRadius: '20%',
        }}
      >
        {/* Arvo stylized A icon */}
        <svg
          width={finalSize * 0.75}
          height={finalSize * 0.75}
          viewBox="0 0 400 318"
          fill="none"
        >
          <path d="M192.307 316.051C190.107 315.031 181.037 308.861 172.147 302.331C155.707 290.251 111.827 258.031 95.0865 245.751C85.1365 238.441 83.0065 235.981 82.1765 230.811C81.5665 227.071 82.8965 223.011 95.7565 189.451C100.187 177.901 103.807 168.341 103.807 168.201C103.807 167.471 89.5565 168.101 87.3765 168.931C84.9565 169.841 84.8065 170.301 84.8065 176.961C84.8065 185.281 82.6565 192.291 76.1265 205.321C66.7965 223.921 63.4665 226.941 52.3065 226.941C44.0365 226.941 39.4265 224.701 37.3565 219.681C36.2965 217.121 35.9465 201.041 35.6665 141.771C35.3065 67.5411 35.3165 67.0811 37.3765 64.2711C41.3965 58.7911 44.6765 57.9511 62.1865 57.9511H78.0665L81.3365 61.411L84.5965 64.8711L85.3265 79.5711C85.7365 87.6511 85.8565 102.521 85.6065 112.611C85.2065 128.491 85.3565 131.121 86.7265 132.211C87.8765 133.141 92.0865 133.391 102.307 133.141L116.307 132.811L122.697 119.131C126.207 111.611 132.667 97.8011 137.047 88.4511C141.427 79.1011 150.807 58.4011 157.887 42.4511C174.337 5.42106 174.587 4.93106 178.807 2.49106C181.777 0.781065 184.507 0.411071 196.747 0.0910708C214.287 -0.358929 220.647 0.791041 224.247 5.06104C227.067 8.41104 227.627 9.56106 234.627 26.4511C237.367 33.0511 246.667 53.9711 255.287 72.9511C263.917 91.9311 273.237 112.851 275.997 119.451C278.757 126.051 281.537 131.781 282.167 132.181C283.537 133.061 303.807 133.181 308.897 132.331L312.497 131.741L313.197 98.7011C313.617 78.5111 314.307 64.851 314.967 63.561C317.607 58.381 319.137 58.001 337.107 57.971C354.867 57.951 357.217 58.4311 361.307 62.9511C363.267 65.1111 363.317 66.791 363.587 138.601C363.777 189.941 363.527 213.291 362.747 216.161C362.147 218.421 360.367 221.541 358.807 223.111C356.167 225.751 355.397 225.951 348.137 225.951C342.687 225.951 339.247 225.421 336.807 224.201C332.117 221.861 325.437 211.591 318.747 196.451C313.927 185.551 313.397 183.631 312.997 175.561L312.547 166.671L304.047 167.271C299.377 167.601 295.367 168.061 295.137 168.281C294.627 168.801 298.307 178.091 309.337 204.091C318.937 226.721 319.267 228.801 314.357 235.881C310.787 241.031 304.437 245.991 267.307 272.631C249.707 285.251 229.687 299.721 222.807 304.771C204.157 318.481 200.487 319.841 192.307 316.051ZM205.957 263.121C213.867 258.951 258.097 226.441 262.777 221.371C267.847 215.871 267.897 213.591 263.167 203.361C261.167 199.021 255.367 184.671 250.277 171.461C239.977 144.701 230.457 122.341 213.887 85.9511C207.747 72.4711 202.047 59.9211 201.207 58.0511C200.327 56.0811 199.337 55.0311 198.817 55.5511C198.337 56.0511 193.617 66.5711 188.317 78.9511C183.027 91.3311 175.797 108.121 172.237 116.271C168.687 124.421 166.067 131.561 166.427 132.151C166.857 132.841 172.427 133.091 182.697 132.871C191.277 132.681 201.287 132.631 204.937 132.741L211.567 132.951L215.567 142.201C217.757 147.291 221.167 154.921 223.137 159.171C225.117 163.411 226.357 167.111 225.907 167.391C225.457 167.661 208.347 168.201 187.887 168.581L150.677 169.271L147.777 175.011C146.187 178.161 143.267 184.721 141.287 189.591C139.317 194.471 136.067 202.181 134.077 206.741C129.647 216.881 130.017 218.621 137.827 224.671C154.257 237.401 185.727 260.441 190.177 262.991C196.577 266.661 199.217 266.681 205.957 263.121Z" fill="#F5EEDD"/>
        </svg>
      </div>
    ),
    {
      width: finalSize,
      height: finalSize,
    }
  )
}
